---
title: "Project Kelompok 11 - Fahmi"
author: "G1401231040 Fahmi Maulana Ardyansyah"
date: "2025-10-09"
output: 
  html_document:
    theme: cerulean
    toc: true
    toc_float: true
---

# Library yang diperlukan
```{r setup, message=FALSE, warning=FALSE}
library(readxl)
library(dplyr)
library(ggplot2)
library(forecast)
library(tsibble)
library(tseries)
library(MASS)
library(TSA)
library(TTR)
library(aTSA)
library(graphics)
```

# Persiapan Data
## Pembacaan Data
```{r}
dataFahmi <- read_excel("E:/(1) Projects/Semester 5/Metode Peramalan Deret Waktu/MPDW/Data/Data MPDWW.xlsx")
# Mengubah data menjadi objek time series (ts)
ts_Fahmi <- ts(dataFahmi$CO2)
head(ts_Fahmi)
```
## Membagi data menjadi data train dan data test
```{r}
n <- length(ts_Fahmi)
nTrain <- round(n * 0.80) 

print(paste("Total Observasi:", n))
print(paste("Jumlah Observasi Training (80%):", nTrain))

DataTrain <- ts_Fahmi[1:nTrain]
DataTest <- ts_Fahmi[(nTrain + 1):n]

print(paste("Panjang Data Train:", length(DataTrain)))
print(paste("Panjang Data Test:", length(DataTest)))

```

## Plot Data
```{r}
# Membuat Plot Data
plot_dataFahmi <- ts_Fahmi |> 
  as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() +
  theme_bw() +
  xlab("Obs") + 
  ylab("Nilai") +
  geom_vline(xintercept = 576, linetype = "dashed", color = "darkblue") +
  ggtitle("Partisi Deret Waktu: Train | Test")

plot_dataFahmi
```
Dari plot tersebut, terlihat bahwa data yang saya miliki **tidak stasioner dalam rataan, stasioner dalam ragam, dan memiliki tren naik**.

## Cek rataan data train stasioner dengan Plot ACF
```{r}
Acf(DataTrain, main="ACF Data CO2")
```
Plot ini menunjukkan bahwa data train saya memiliki nilai korelasi tinggi dan **tidak stasioner** dalam rataan karena adanya tren naik.

## Cek rataan data train stasioner dengan Uji ADF
$H_0$ : Data train tidak stasioner dalam rataan

$H_1$ : Data train stasioner dalam rataan
```{r}
tseries::adf.test(DataTrain)
```
Berdasarkan uji ADF tersebut, didapat *p-value* yang lebih besar dari 0.05 sehingga tak tolak $H_0$. Artinya, data train **tidak stasioner dalam rataan**.

## Cek ragam data train stasioner dengan Plot Boxcox

```{r}
index <- seq(1, 576)

# Box-Cox
bc <- boxcox(DataTrain ~ index, lambda = seq(-8, 4, by = 0.01)
)
```

```{r}
lambda <- bc$x[which.max(bc$y)]
lambda
```

```{r}
# Selang kepercayaan 95% untuk lambda
ci_lambda <- bc$x[bc$y > max(bc$y) - 0.5 * qchisq(0.95, 1)]

# Batas bawah dan batas atas
ci_lower <- min(ci_lambda)
ci_upper <- max(ci_lambda)

c(Batas_Bawah = ci_lower, Batas_Atas = ci_upper)
```
Gambar di atas menunjukkan nilai Î» optimum (rounded value) sebesar **-1.95** dan selang kepercayaan 95% nilai memiliki batas bawah **-2.25** dan batas atas **-1.66**. Selang tersebut tidak memuat nilai satu sehingga terdapat cukup bukti untuk mengatakan bahwa data train saya **tidak stasioner dalam ragam** pada taraf nyata 5%.

## Kesimpulan dari data
Data train saya **tidak stasioner dalam rataan dan tidak stasioner dalam ragam** pada taraf nyata 5%.

## Penanganan pada data train
### Differencing pertama
```{r}
# Differencing pertama pada DataTrain
DataTrain_diff1 <- diff(DataTrain, differences = 1)
```
#### Plot hasil differencing pertama
```{r}
ts.plot(DataTrain_diff1,
        main = "Differencing pertama pada DataTrain",
        col = "darkblue", lwd = 2)
```
Plot hasil differencing (Differencing pertama pada DataTrain) menunjukkan data train sekarang berfluktuasi di sekitar nilai nol.

Tren naik sudah hilang karena saya telah melakukan differencing orde 1.

#### Plot ACF hasil differencing pertama
```{r}
acf(DataTrain_diff1)
```
Plot ACF menunjukkan korelasi yang turun tajam menuju nol setelah lag kecil (sekitar Lag=1 atau Lag=2). Ini mengonfirmasi bahwa tren sudah berhasil dihilangkan.

#### Uji ADF hasil differencing pertama
$H_0$ : Data train hasil differencing pertama tidak stasioner dalam rataan

$H_1$ : Data train hasil differencing pertama stasioner dalam rataan
```{r}
tseries::adf.test(DataTrain_diff1)
```
Berdasarkan uji ADF tersebut, didapat *p-value* yang lebih kecil dari 0.01 yang lebih kecil dari taraf nyata 5% sehingga tolak $H_0$ dan menandakan bahwa data train hasil differencing pertama **stasioner dalam rataan**. Hal ini sesuai dengan hasil eksplorasi menggunakan plot time series dan plot ACF terhadap data train hasil differencing pertama.

#### Cek ragam data train hasil differencing pertama stasioner dengan Plot Boxcox

```{r}
# Box-Cox
index1 <- seq(1, 575)

# 1. Hitung nilai minimum
min_val <- min(DataTrain_diff1)

# 2. Tentukan konstanta pergeseran (misalnya min_val + 1)
c <- abs(min_val) + 1 

# 3. Buat variabel respons yang sudah digeser
DataTrain_diff1_shifted <- DataTrain_diff1 + c

# 4. Terapkan boxcox pada data yang sudah digeser
bc1 <- boxcox(DataTrain_diff1_shifted ~ index1, lambda = seq(-2, 6, by = 0.01))
```
### Kesimpulan Hasil Differencing pertama
Setelah dilakukan differencing pertama, **data train menjadi stasioner dalam rataan dan stasioner dalam ragam** pada taraf nyata 5%.

# Permodelan SARIMA
```{r}
D1 <- diff(DataTrain,12)
ts.plot(D1, type="l", ylab="D1 Xt", col="darkblue")
```

```{r}
acf2<-acf(D1,lag.max=48,xaxt="n", main="ACF D1", col="blue")
```

```{r}
acf2$lag <- acf2$lag * 12
acf2.1 <- as.data.frame(cbind(acf2$acf,acf2$lag))
acf2.2 <- acf2.1[which(acf2.1$V2%%12==0),]
barplot(height = acf2.2$V1, names.arg=acf2.2$V2, ylab="ACF", xlab="Lag")
```

Non-seasonal differencing D = 12 berhasil mengatasi ketidakstasioneran dalam rataan untuk komponen seasonalnya (namun tidak untuk komponen non-seasonalnya).

Untuk menghilangkan kecenderungan musiman dilakukan pembedaan musiman terhadap deret hasil pembedaan pertama.

```{r}
d1D1 <- diff(D1)
ts.plot(d1D1, type="l", ylab="d1 D1 Xt", col="blue")
```

Setelah pembedaan pertama dan pembedaan musiman tampak bahwa deret sudah tidak memiliki kecenderungan apapun. Selanjutnya penentuan ordo p, q dan P, Q dapat dilakukan menggunakan plot ACF dan PACF contoh dari deret hasil pembedaan pertama dan pembedaan musiman tersebut.

# Identifikasi Model
```{r}
acf3 <- acf(d1D1,lag.max=48,xaxt="n", main="ACF d1D1", col="blue")
axis(1, at=0:48/12, labels=0:48)
```

```{r}
acf3$lag <- acf3$lag * 12
acf3.1 <- as.data.frame(cbind(acf3$acf,acf3$lag))
acf3.2 <- acf3.1[which(acf3.1$V2%%12==0),]
barplot(height = acf3.2$V1, names.arg=acf3.2$V2, ylab="ACF", 
xlab="Lag")
```

Berdasarkan plot ACF contoh lag 1 signifikan sehingga dipilih ordo q=1 , dan lag 12 adalah satu-satunya lag musiman yang signifikan sehingga order Q=1.

```{r}
pacf3 <- pacf(d1D1,lag.max=48,xaxt="n", main="PACF d1D1", col="blue")
axis(1, at=0:48/12, labels=0:48)
```

```{r}
pacf3$lag <- pacf3$lag * 12
pacf3.1 <- as.data.frame(cbind(pacf3$acf,pacf3$lag))
pacf3.2 <- pacf3.1[which(pacf3.1$V2%%12==0),]
barplot(height = pacf3.2$V1, names.arg=pacf3.2$V2, ylab="PACF", xlab="Lag")
```

Plot PACF contoh menunjukkan cuts-off pada lag-1 sehingga ordo p=1, sementara pada pola musimannya tidak terlihat model AR yang terbentuk karena cenderung tails-off.

Model musiman yang dipilih untuk deret konsentrasi karbon dioksida adalah ARIMA(0,1,1) X (0,1,1)12, ARIMA(1,1,0) X (0,1,1)12, dan ARIMA(1,1,1) X (0,1,1)12

## EACF
```{r}
TSA::eacf(d1D1)
```

Karena, kedua komponen telah stasioner. Identifikasi komponen non-seasonal adalah ARIMA(0,1,3), ARIMA(1,1,3). Identifikasi komponen seasonal adalah ARIMA(0,1,1)12 sehingga model tentatif yang diperoleh adalah RIMA(0,1,1) X (0,1,1)12, ARIMA(1,1,0) X (0,1,1)12, ARIMA(1,1,1) X (0,1,1)12, ARIMA(0,1,3) X (0,1,1)12, ARIMA(1,1,3) X (0,1,1)12

## Pedugaan Parameter
###ARIMA(0,1,1)x(0,1,1)12
```{r}
tmodel1 <- Arima(DataTrain,order=c(0,1,1),seasonal=c(0,1,1))
summary(tmodel1)
```

```{r}
lmtest::coeftest(tmodel1)
```

###ARIMA(1,1,0)x(0,1,1)12
```{r}
tmodel2 <- Arima(DataTrain,order=c(1,1,0),seasonal=c(0,1,1))
summary(tmodel2)
```

```{r}
lmtest::coeftest(tmodel2)
```

###ARIMA(1,1,0)x(0,1,1)12
```{r}
tmodel3 <- Arima(DataTrain,order=c(1,1,1),seasonal=c(0,1,1))
summary(tmodel3)
```

```{r}
lmtest::coeftest(tmodel3)
```

###ARIMA(0,1,3)x(0,1,1)12
```{r}
tmodel4 <- Arima(DataTrain,order=c(0,1,3),seasonal=c(0,1,1))
summary(tmodel4)
```

```{r}
lmtest::coeftest(tmodel4)
```

###ARIMA(1,1,3)x(0,1,1)12
```{r}
tmodel5 <- Arima(DataTrain,order=c(1,1,3),seasonal=c(0,1,1))
summary(tmodel5)
```

```{r}
lmtest::coeftest(tmodel5)
```

###Perbandingan Model
```{r}
AICKandidatModel <- c(tmodel1$aic, tmodel2$aic, tmodel3$aic,
                      tmodel4$aic, tmodel5$aic)
AICcKandidatModel <- c(tmodel1$aicc, tmodel2$aicc, tmodel3$aicc,
                       tmodel4$aicc, tmodel5$aicc)
BICKandidatModel <- c(tmodel1$bic, tmodel2$bic, tmodel3$bic,
                      tmodel4$bic, tmodel5$bic)
KandidatModelARIMA <- c("ARIMA(0,1,1)(0,1,1)12", "ARIMA(1,1,0)(0,1,1)12",
                        "ARIMA(1,1,1)(0,1,1)12", "ARIMA(0,1,3)(0,1,1)12",
                        "ARIMA(1,1,3)(0,1,1)12")
compmodelARIMA <- cbind(KandidatModelARIMA, AICKandidatModel,
                        AICcKandidatModel, BICKandidatModel)
colnames(compmodelARIMA) <- c("Kandidat Model", "Nilai AIC", 
                              "Nilai AICc", "Nilai BIC")
compmodelARIMA <- as.data.frame(compmodelARIMA)
compmodelARIMA
```

Model terbaik berdasarkan nilai AIC dan AICc terkecil dari kandidat model yaitu ARIMA(0,1,3)x(0,1,1)12, Namun, dengan mempertimbangkan signifikansi parameter dan kesederhanaan, model yang dipilih ARIMA(0,1,1)x(0,1,1)12

##Diagnostik Model
###Eksplorasi
```{r}
tsdisplay(residuals(tmodel1), lag.max=45, 
          main='ARIMA(0,1,1)(0,1,1)12 Model Residuals', col="blue")
```

```{r}
#Eksplorasi
sisaan.model1 <- tmodel1$residuals
par(mfrow=c(2,2))
car::qqPlot(sisaan.model1)
```

```{r}
plot(c(1:length(sisaan.model1)),sisaan.model1)
acf(sisaan.model1)
pacf(sisaan.model1)
```

Berdasarkan plot di atas terlihat bahwa sisaan mengikuti sebaran normal. Selanjutnya, ditinjau dari plot ACF dan PACF terlihat bahwa ada lag yang signifikan. Hal tersebut menunjukkan bahwa kemungkinan ada gejala autokorelasi pada sisaan. Selanjutnya, untuk memastikan kembali akan dilakukan uji asumsi secara formal:

###Uji Formal
```{r}
#1) Sisaan Menyebar Normal
ks.test(sisaan.model1,"pnorm")
```

```{r}
#tak tolak H0 > sisaan menyebar normal
shapiro.test(sisaan.model1)
```

```{r}
nortest::ad.test(sisaan.model1)
```

erdasarkan uji KS tersebut, didapat p-value sebesar 0.000 yang lebih kecil dari taraf nyata 5% sehingga tolak HO dan menandakan bahwa sisaan menyebar normal. Namun, hasil ini berbeda dengan Shapiro-Wilk test dan Anderson-Darling test yang menunjukkan p-value > 5%. Hasil uji formal Shapiro-Wilk dan Anderson-Darling lebih sesuai dengan plot eksplorasi.

```{r}
#2) Sisaan saling bebas/tidak ada autokorelasi
Box.test(sisaan.model1, type = "Ljung") 
```

```{r}
#tak tolak H0 > sisaan saling bebas
```
Berdasarkan uji Ljung-Box tersebut, didapat p-value sebesar 0.6024 yang lebih besar dari taraf nyata 5% sehingga tak tolak H0 dan menandakan bahwa sisaan saling bebas. Hal ini berbeda dengan eksplorasi.

```{r}
#3) Sisaan homogen 
Box.test((sisaan.model1)^2, type = "Ljung")  
```

```{r}
#tak tolak H0 > sisaan homogen
```
Berdasarkan uji Ljung-Box terhadap sisaan kuadrat tersebut, didapat p-value sebesar 0.615 yang lebih besar dari taraf nyata 5% sehingga tak tolak H0 dan menandakan bahwa ragam sisaan homogen.


```{r}
#4) Nilai tengah sisaan sama dengan nol 
t.test(sisaan.model1, mu = 0, conf.level = 0.95) 
```

```{r}
#tak tolak h0 > nilai tengah sisaan sama dengan 0
```

Berdasarkan uji-ttersebut, didapat p-value sebesar 0.1583 yang lebih besar dari taraf nyata 5% sehingga tak tolak H0 dan menandakan bahwa nilai tengah sisaan sama dengan nol. Hal ini berbeda dengan eksplorasi.