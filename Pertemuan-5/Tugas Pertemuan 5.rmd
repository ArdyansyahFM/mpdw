---
title: "Tugas Pertemuan 5"
author: "G1401231040 Fahmi Maulana Ardyanysah"
date: "2025-10-09"
output: 
  html_document:
    theme: cerulean
    toc: true
    toc_float: true
    code-fold: false
    code-copy: true
---

# Library yang diperlukan
```{r setup, message=FALSE, warning=FALSE}
library(readxl)
library(dplyr)
library(ggplot2)
library(forecast)
library(tsibble)
library(tseries)
library(MASS)
```

# Pembacaan Data
```{r}
data <- read_excel("E:/(1) Projects/Semester 5/Metode Peramalan Deret Waktu/MPDW/Data/Data MPDWW.xlsx")
dataFahmi = data[541:720, ]
head(dataFahmi)
# Mengubah data menjadi objek time series (ts)
ts_Fahmi <- ts(dataFahmi$CO2)
head(ts_Fahmi)
```
# Membagi data menjadi data train dan data test
```{r}
n <- length(ts_Fahmi)
nTrain <- round(n * 0.80) 

print(paste("Total Observasi:", n))
print(paste("Jumlah Observasi Training (80%):", nTrain))

DataTrain <- ts_Fahmi[1:nTrain]
DataTest <- ts_Fahmi[(nTrain + 1):n]

print(paste("Panjang Data Train:", length(DataTrain)))
print(paste("Panjang Data Test:", length(DataTest)))

```

# Plot Data
```{r}
# Membuat Plot Data
plot_dataFahmi <- ts_Fahmi |> 
  as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() +
  theme_bw() +
  xlab("Obs") + 
  ylab("Nilai") +
  geom_vline(xintercept = 144, linetype = "dashed", color = "darkblue") +
  ggtitle("Partisi Deret Waktu: Train | Test")

plot_dataFahmi
```
Dari plot tersebut, terlihat bahwa data yang saya miliki **tidak stasioner dalam rataan, stasioner dalam ragam, dan memiliki tren naik**.

# Cek rataan data train stasioner dengan Plot ACF
```{r}
Acf(DataTrain, main="ACF Data CO2")
```
Plot ini menunjukkan bahwa data train saya memiliki nilai korelasi tinggi dan **tidak stasioner** dalam rataan karena adanya tren naik.

# Cek rataan data train stasioner dengan Uji ADF
$H_0$ : Data train tidak stasioner dalam rataan

$H_1$ : Data train stasioner dalam rataan
```{r}
tseries::adf.test(DataTrain)
```
Berdasarkan uji ADF tersebut, didapat *p-value* yang lebih kecil dari 0.01 yang lebih kecil dari taraf nyata 5% sehingga tolak $H_0$ dan menandakan bahwa data train **stasioner dalam rataan**.

Kendati demikian, uji ADF adalah uji yang memasukkan unsur tren dalam model pengujiannya, sehingga jika suatu data memiliki tren tertentu, maka ADF akan 'mengoreksi' tren tersebut secara otomatis untuk menyatakan apakah data tersebut memiliki rataan yang tidak stasioner dan "melenceng" dari trennya. Oleh karena itu, walaupun uji ADF menyatakan bahwa data train saya stasioner dalam rataan, saya lebih mempercayai *plot time series* dan *plot ACF* yang benar-benar menunjukkan bahwa **data train saya tidak stasioner dalam rataan** (tidak peduli dengan trennya).

# Cek ragam data train stasioner dengan Plot Boxcox

```{r}
index <- seq(1, 144)

# Box-Cox
bc <- boxcox(DataTrain ~ index, lambda = seq(-6, 6, by = 0.01)
)
```

```{r}
lambda <- bc$x[which.max(bc$y)]
lambda
```

```{r}
# Selang kepercayaan 95% untuk lambda
ci_lambda <- bc$x[bc$y > max(bc$y) - 0.5 * qchisq(0.95, 1)]

# Batas bawah dan batas atas
ci_lower <- min(ci_lambda)
ci_upper <- max(ci_lambda)

c(Batas_Bawah = ci_lower, Batas_Atas = ci_upper)
```
Gambar di atas menunjukkan nilai Î» optimum (rounded value) sebesar **-0.31** dan selang kepercayaan 95% nilai memiliki batas bawah **-4.26** dan batas atas **3.64**. Selang tersebut memuat nilai satu sehingga dapat dikatakan bahwa data train saya **stasioner dalam ragam** pada taraf nyata 5%.

# Kesimpulan dari data
Data train saya **tidak stasioner dalam rataan, tetapi stasioner dalam ragam** pada taraf nyata 5%.

# Penanganan pada data train
## Differencing pertama
```{r}
# Differencing pertama pada DataTrain
DataTrain_diff1 <- diff(DataTrain, differences = 1)
```
### Plot hasil differencing pertama
```{r}
ts.plot(DataTrain_diff1,
        main = "Differencing pertama pada DataTrain",
        col = "darkblue", lwd = 2)
```
Plot hasil differencing (Differencing pertama pada DataTrain) menunjukkan data train sekarang berfluktuasi di sekitar nilai nol.

Tren naik sudah hilang karena saya telah melakukan differencing orde 1.

### Plot ACF hasil differencing pertama
```{r}
acf(DataTrain_diff1)
```
Plot ACF menunjukkan korelasi yang turun tajam menuju nol setelah lag kecil (sekitar Lag=1 atau Lag=2). Ini mengonfirmasi bahwa tren sudah berhasil dihilangkan.

### Uji ADF hasil differencing pertama
$H_0$ : Data train hasil differencing pertama tidak stasioner dalam rataan

$H_1$ : Data train hasil differencing pertama stasioner dalam rataan
```{r}
tseries::adf.test(DataTrain_diff1)
```
Berdasarkan uji ADF tersebut, didapat *p-value* yang lebih kecil dari 0.01 yang lebih kecil dari taraf nyata 5% sehingga tolak $H_0$ dan menandakan bahwa data train hasil differencing pertama **stasioner dalam rataan**. Hal ini sesuai dengan hasil eksplorasi menggunakan plot time series dan plot ACF terhadap data train hasil differencing pertama.

## Kesimpulan Hasil Differencing pertama
Setelah dilakukan differencing pertama, **data train menjadi stasioner dalam rataan dan stasioner dalam ragam** pada taraf nyata 5%.